{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://docs.anthropic.com/en/api/messages",
  "title": "Anthropic Messages API Schema",
  "description": "Anthropic Claude Messages API 的请求和响应 JSON Schema 定义",
  "type": "object",
  
  "definitions": {
    "cache_control_ephemeral": {
      "type": "object",
      "description": "缓存控制断点",
      "properties": {
        "type": {
          "type": "string",
          "const": "ephemeral"
        },
        "ttl": {
          "type": "string",
          "enum": ["5m", "1h"],
          "description": "缓存保留时间，默认为 5m"
        }
      },
      "required": ["type"]
    },
    
    "content_block_param": {
      "oneOf": [
        {
          "type": "string",
          "description": "简单的文本内容"
        },
        {
          "type": "object",
          "description": "文本内容块",
          "properties": {
            "type": {
              "type": "string",
              "const": "text"
            },
            "text": {
              "type": "string",
              "description": "文本内容"
            },
            "cache_control": {
              "$ref": "#/definitions/cache_control_ephemeral"
            },
            "citations": {
              "type": "array",
              "description": "引用信息"
            }
          },
          "required": ["type", "text"]
        },
        {
          "type": "object",
          "description": "图片内容块",
          "properties": {
            "type": {
              "type": "string",
              "const": "image"
            },
            "source": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "base64"
                    },
                    "media_type": {
                      "type": "string",
                      "enum": ["image/jpeg", "image/png", "image/gif", "image/webp"]
                    },
                    "data": {
                      "type": "string",
                      "description": "Base64 编码的图片数据"
                    }
                  },
                  "required": ["type", "media_type", "data"]
                },
                {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "url"
                    },
                    "url": {
                      "type": "string",
                      "format": "uri"
                    }
                  },
                  "required": ["type", "url"]
                }
              ]
            },
            "cache_control": {
              "$ref": "#/definitions/cache_control_ephemeral"
            }
          },
          "required": ["type", "source"]
        },
        {
          "type": "object",
          "description": "文档内容块",
          "properties": {
            "type": {
              "type": "string",
              "const": "document"
            },
            "source": {
              "oneOf": [
                {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "base64"
                    },
                    "media_type": {
                      "type": "string",
                      "const": "application/pdf"
                    },
                    "data": {
                      "type": "string"
                    }
                  },
                  "required": ["type", "media_type", "data"]
                },
                {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "text"
                    },
                    "media_type": {
                      "type": "string",
                      "const": "text/plain"
                    },
                    "data": {
                      "type": "string"
                    }
                  },
                  "required": ["type", "media_type", "data"]
                },
                {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "url"
                    },
                    "url": {
                      "type": "string",
                      "format": "uri"
                    }
                  },
                  "required": ["type", "url"]
                }
              ]
            },
            "cache_control": {
              "$ref": "#/definitions/cache_control_ephemeral"
            },
            "citations": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean"
                }
              }
            },
            "context": {
              "type": "string"
            },
            "title": {
              "type": "string"
            }
          },
          "required": ["type", "source"]
        },
        {
          "type": "object",
          "description": "搜索结果内容块",
          "properties": {
            "type": {
              "type": "string",
              "const": "search_result"
            },
            "content": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/content_block_param"
              }
            },
            "source": {
              "type": "string"
            },
            "title": {
              "type": "string"
            },
            "cache_control": {
              "$ref": "#/definitions/cache_control_ephemeral"
            },
            "citations": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean"
                }
              }
            }
          },
          "required": ["type", "content", "source", "title"]
        },
        {
          "type": "object",
          "description": "思考块",
          "properties": {
            "type": {
              "type": "string",
              "const": "thinking"
            },
            "thinking": {
              "type": "string"
            },
            "signature": {
              "type": "string"
            }
          },
          "required": ["type", "thinking"]
        },
        {
          "type": "object",
          "description": "工具调用块",
          "properties": {
            "type": {
              "type": "string",
              "const": "tool_use"
            },
            "id": {
              "type": "string",
              "description": "工具调用 ID"
            },
            "name": {
              "type": "string",
              "description": "工具名称"
            },
            "input": {
              "type": "object",
              "description": "工具输入参数"
            },
            "cache_control": {
              "$ref": "#/definitions/cache_control_ephemeral"
            }
          },
          "required": ["type", "id", "name", "input"]
        },
        {
          "type": "object",
          "description": "工具结果块",
          "properties": {
            "type": {
              "type": "string",
              "const": "tool_result"
            },
            "tool_use_id": {
              "type": "string"
            },
            "content": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/content_block_param"
                  }
                }
              ]
            },
            "is_error": {
              "type": "boolean"
            },
            "cache_control": {
              "$ref": "#/definitions/cache_control_ephemeral"
            }
          },
          "required": ["type", "tool_use_id"]
        }
      ]
    },
    
    "message_role": {
      "type": "string",
      "enum": ["user", "assistant"],
      "description": "消息角色"
    },
    
    "message": {
      "type": "object",
      "description": "输入消息",
      "properties": {
        "role": {
          "$ref": "#/definitions/message_role"
        },
        "content": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/content_block_param"
              }
            }
          ]
        }
      },
      "required": ["role", "content"]
    },
    
    "response_message": {
      "type": "object",
      "description": "响应消息",
      "properties": {
        "role": {
          "type": "string",
          "const": "assistant"
        },
        "content": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/content_block_param"
              }
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": ["role"]
    },
    
    "usage": {
      "type": "object",
      "description": "Token 使用统计",
      "properties": {
        "input_tokens": {
          "type": "integer",
          "description": "输入 token 数量"
        },
        "output_tokens": {
          "type": "integer",
          "description": "输出 token 数量"
        },
        "cache_creation_input_tokens": {
          "type": "integer",
          "description": "缓存创建的输入 token"
        },
        "cache_read_input_tokens": {
          "type": "integer",
          "description": "缓存读取的输入 token"
        }
      }
    }
  },
  
  "properties": {
    "request": {
      "type": "object",
      "description": "Messages API 请求",
      "properties": {
        "model": {
          "type": "string",
          "description": "模型名称，如 claude-sonnet-4-20250514"
        },
        "max_tokens": {
          "type": "integer",
          "description": "最大生成 token 数"
        },
        "messages": {
          "type": "array",
          "description": "输入消息列表",
          "items": {
            "$ref": "#/definitions/message"
          }
        },
        "system": {
          "type": "string",
          "description": "系统提示词"
        },
        "stream": {
          "type": "boolean",
          "default": false,
          "description": "是否启用流式响应"
        },
        "stop_sequences": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "停止序列列表"
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "采样温度"
        },
        "top_p": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "核采样参数"
        },
        "top_k": {
          "type": "integer",
          "minimum": 0,
          "description": "top-k 采样参数"
        },
        "metadata": {
          "type": "object",
          "description": "元数据"
        }
      },
      "required": ["model", "messages", "max_tokens"]
    },
    
    "response": {
      "type": "object",
      "description": "Messages API 响应",
      "properties": {
        "id": {
          "type": "string",
          "description": "响应 ID"
        },
        "type": {
          "type": "string",
          "const": "message"
        },
        "role": {
          "type": "string",
          "const": "assistant"
        },
        "content": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/content_block_param"
          }
        },
        "model": {
          "type": "string",
          "description": "使用的模型"
        },
        "stop_reason": {
          "type": "string",
          "enum": ["end_turn", "max_tokens", "stop_sequence"],
          "description": "停止原因"
        },
        "stop_sequence": {
          "type": ["string", "null"],
          "description": "触发的停止序列"
        },
        "usage": {
          "$ref": "#/definitions/usage"
        }
      },
      "required": ["id", "type", "role", "content", "model", "stop_reason", "usage"]
    },
    
    "stream_event": {
      "oneOf": [
        {
          "type": "object",
          "description": "流式事件 - 头部",
          "properties": {
            "type": {
              "type": "string",
              "const": "message_start"
            },
            "message": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "type": {
                  "type": "string"
                },
                "role": {
                  "type": "string"
                },
                "model": {
                  "type": "string"
                },
                "usage": {
                  "$ref": "#/definitions/usage"
                }
              }
            }
          },
          "required": ["type", "message"]
        },
        {
          "type": "object",
          "description": "流式事件 - 内容块开始",
          "properties": {
            "type": {
              "type": "string",
              "const": "content_block_start"
            },
            "index": {
              "type": "integer"
            },
            "content_block": {
              "$ref": "#/definitions/content_block_param"
            }
          },
          "required": ["type", "index", "content_block"]
        },
        {
          "type": "object",
          "description": "流式事件 - 内容块增量",
          "properties": {
            "type": {
              "type": "string",
              "const": "content_block_delta"
            },
            "index": {
              "type": "integer"
            },
            "delta": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string"
                },
                "text": {
                  "type": "string"
                },
                "partial_json": {
                  "type": "string"
                }
              }
            }
          },
          "required": ["type", "index", "delta"]
        },
        {
          "type": "object",
          "description": "流式事件 - 内容块停止",
          "properties": {
            "type": {
              "type": "string",
              "const": "content_block_stop"
            },
            "index": {
              "type": "integer"
            }
          },
          "required": ["type", "index"]
        },
        {
          "type": "object",
          "description": "流式事件 - 消息停止",
          "properties": {
            "type": {
              "type": "string",
              "const": "message_delta"
            },
            "delta": {
              "type": "object",
              "properties": {
                "stop_reason": {
                  "type": "string"
                },
                "stop_sequence": {
                  "type": ["string", "null"]
                }
              }
            },
            "usage": {
              "$ref": "#/definitions/usage"
            }
          },
          "required": ["type", "delta", "usage"]
        },
        {
          "type": "object",
          "description": "流式事件 - 消息停止",
          "properties": {
            "type": {
              "type": "string",
              "const": "message_stop"
            },
            "reason": {
              "type": "string"
            }
          },
          "required": ["type", "reason"]
        },
        {
          "type": "object",
          "description": "流式事件 - 错误",
          "properties": {
            "type": {
              "type": "string",
              "const": "error"
            },
            "error": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string"
                },
                "message": {
                  "type": "string"
                }
              }
            }
          },
          "required": ["type", "error"]
        },
        {
          "type": "object",
          "description": "流式事件 - 心跳",
          "properties": {
            "type": {
              "type": "string",
              "const": "ping"
            }
          },
          "required": ["type"]
        }
      ]
    }
  }
}
