# é”™è¯¯æ¨¡å¼é…ç½®æ›´æ–°æŠ¥å‘Š

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

**æ›´æ–°æ—¶é—´**: 2026-01-19  
**æ›´æ–°å†…å®¹**: æ–°å¢3ä¸ªéœ€è¦ç«‹å³è§¦å‘å›é€€çš„é”™è¯¯æ¨¡å¼  
**å½±å“æ–‡ä»¶**: 
- `src/config.yaml`
- `src/config.example.yaml`

---

## ğŸ” æ–°å¢é”™è¯¯æ¨¡å¼

### 1. ç»„ç»‡è¢«ç¦ç”¨é”™è¯¯
**é”™è¯¯æ¥æº**: Claude API  
**çŠ¶æ€ç **: 400  
**é”™è¯¯ä¿¡æ¯**:
```json
{
    "type": "error",
    "error": {
        "type": "invalid_request_error",
        "message": "This organization has been disabled."
    },
    "request_id": "req_011CXFtybv84NUBEF4zAMDw1"
}
```
**åŒ¹é…æ¨¡å¼**: `"organization has been disabled"`

---

### 2. ä¸Šæ¸¸è´¦å·å…¨å¿™é”™è¯¯
**é”™è¯¯æ¥æº**: ä¸Šæ¸¸ä»£ç†æœåŠ¡  
**çŠ¶æ€ç **: 503  
**é”™è¯¯ä¿¡æ¯**:
```json
{
    "error": {
        "message": "ç³»ç»Ÿç¹å¿™,ä¸Šæ¸¸è´¦å·å…¨å¿™,è¯·ç¨åé‡è¯•",
        "type": "server_error",
        "code": "upstream_all_accounts_busy",
        "param": null,
        "metadata": {
            "provider": "claude"
        }
    }
}
```
**åŒ¹é…æ¨¡å¼**: `"upstream_all_accounts_busy"`

---

### 3. æ— æ•ˆèŠå¤©è®¾ç½®é”™è¯¯
**é”™è¯¯æ¥æº**: MiniMax API  
**çŠ¶æ€ç **: 400  
**é”™è¯¯ä¿¡æ¯**:
```json
{
    "type": "error",
    "error": {
        "type": "bad_request_error",
        "message": "invalid params, invalid chat setting (2013)",
        "http_code": "400"
    },
    "request_id": "05bcc40802dba81ddec8353182c801c8"
}
```
**åŒ¹é…æ¨¡å¼**: `"invalid chat setting"`

---

## ğŸ“ é…ç½®å˜æ›´è¯¦æƒ…

### æ›´æ–°å‰çš„ error_patterns:
```yaml
error_patterns:
  - "insufficient_quota"
  - "rate_limit"
  - "exceeded"
  - "billing"
  - "quota"
```

### æ›´æ–°åçš„ error_patterns:
```yaml
error_patterns:
  - "insufficient_quota"
  - "rate_limit"
  - "exceeded"
  - "billing"
  - "quota"
  - "organization has been disabled"
  - "upstream_all_accounts_busy"
  - "invalid chat setting"
```

---

## ğŸ”„ é”™è¯¯å¤„ç†æµç¨‹

```
è¯·æ±‚å‘é€ â†’ æ”¶åˆ°å“åº” â†’ æ£€æŸ¥çŠ¶æ€ç  (4xx/5xx)
                              â†“
                    æ£€æŸ¥å“åº”ä½“ä¸­çš„é”™è¯¯æ¨¡å¼
                              â†“
                    åŒ¹é…åˆ°ä»»ä¸€é”™è¯¯æ¨¡å¼
                              â†“
                    è§¦å‘ç«‹å³å›é€€æœºåˆ¶
                              â†“
                    åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨åç«¯
```

---

## âœ… éªŒè¯æ¸…å•

- [x] æ›´æ–° `src/config.yaml`
- [x] æ›´æ–° `src/config.example.yaml`
- [x] éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®
- [x] ç¡®è®¤é”™è¯¯æ¨¡å¼åŒ¹é…é€»è¾‘
- [ ] é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
- [ ] æµ‹è¯•é”™è¯¯å›é€€åŠŸèƒ½

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

1. **é‡å¯æœåŠ¡**
   ```bash
   # åœæ­¢å½“å‰æœåŠ¡
   # é‡æ–°å¯åŠ¨æœåŠ¡ä»¥åŠ è½½æ–°é…ç½®
   ```

2. **ç›‘æ§æ—¥å¿—**
   - è§‚å¯Ÿæ˜¯å¦è¿˜æœ‰ç±»ä¼¼é”™è¯¯æ—¥å¿—å‡ºç°
   - éªŒè¯å›é€€æœºåˆ¶æ˜¯å¦æ­£å¸¸è§¦å‘

3. **æŒç»­ä¼˜åŒ–**
   - æ”¶é›†æ›´å¤šé”™è¯¯æ¨¡å¼
   - å®Œå–„é”™è¯¯æ£€æµ‹é€»è¾‘

---

## ğŸ“Š å½±å“åˆ†æ

**æ­£é¢å½±å“**:
- âœ… å‡å°‘æ— æ•ˆé‡è¯•ï¼Œæé«˜å“åº”é€Ÿåº¦
- âœ… è‡ªåŠ¨åˆ‡æ¢å¯ç”¨åç«¯ï¼Œæå‡æœåŠ¡å¯ç”¨æ€§
- âœ… é¿å…å°†æ˜ç¡®çš„é”™è¯¯ç»§ç»­å‘é€åˆ°åŒä¸€åç«¯

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ
- âš ï¸ ç¡®ä¿æœ‰è¶³å¤Ÿçš„å¤‡ç”¨åç«¯å¯ä¾›å›é€€
- âš ï¸ ç›‘æ§å›é€€é¢‘ç‡ï¼Œé¿å…é¢‘ç¹åˆ‡æ¢

---

## ğŸ“ ç›¸å…³ä»£ç ä½ç½®

- é”™è¯¯æ£€æµ‹é€»è¾‘: `src/proxy/error_detector.go`
- å›é€€å¤„ç†é€»è¾‘: `src/proxy/fallback_handler.go`
- é…ç½®åŠ è½½: `src/config/config.go`

