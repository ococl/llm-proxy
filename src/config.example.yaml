listen: ":8080"

proxy_api_key: "sk-your-unified-api-key"

proxy:
  enable_system_prompt: false
  forward_client_ip: true

backends:
- name: "primary"
  url: "https://api.primary-provider.com/v1"
  api_key: "sk-primary-xxx"
  locale: "zh-CN"  # 简体中文响应（默认区域）

- name: "secondary"
  url: "https://api.secondary-provider.com/v1"
  api_key: "sk-secondary-yyy"
  enabled: false

# Anthropic 协议示例
- name: "anthropic"
  url: "https://api.anthropic.com"
  api_key: "sk-ant-xxx"
  protocol: "anthropic"  # 指定使用 Anthropic 协议
  locale: "en-US"  # 英文响应

# Azure OpenAI 协议示例
- name: "azure-openai"
  url: "https://your-resource.openai.azure.com/openai/deployments/your-deployment"
  api_key: "your-azure-api-key"
  protocol: "azure"  # Azure 专用错误转换器
  timeout: 60s  # Azure 可能需要更长超时
  locale: "zh-CN"

# DeepSeek 协议示例
- name: "deepseek"
  url: "https://api.deepseek.com/chat/completions"
  api_key: "sk-deepseek-xxx"
  protocol: "deepseek"  # 支持 thinking mode

# Groq 协议示例
- name: "groq"
  url: "https://api.groq.com/openai/v1/chat/completions"
  api_key: "gsk-xxx"
  protocol: "groq"  # 高性能推理加速

# Mistral AI 协议示例
- name: "mistral"
  url: "https://api.mistral.ai/v1/chat/completions"
  api_key: "xxx"
  protocol: "mistral"  # 支持并行工具调用

# Cohere 协议示例
- name: "cohere"
  url: "https://api.cohere.com/v1/chat"
  api_key: "xxx"
  protocol: "cohere"  # RAG 和 citations 支持

models:
  "anthropic/claude-sonnet-4":
    routes:
    - backend: "primary"
      model: "claude-sonnet-4"
      priority: 1
    - backend: "secondary"
      model: "claude-sonnet-4"
      priority: 2
      enabled: false

  "openai/gpt-4o":
    enabled: false
    routes:
    - backend: "primary"
      model: "gpt-4o"
      priority: 1

  # DeepSeek 模型示例
  "deepseek/deepseek-chat":
    routes:
    - backend: "deepseek"
      model: "deepseek-chat"
      priority: 1

  # Groq 模型示例（Llama 系列）
  "groq/llama-3.3-70b-versatile":
    routes:
    - backend: "groq"
      model: "llama-3.3-70b-versatile"
      priority: 1

  # Mistral 模型示例
  "mistral/mistral-large-latest":
    routes:
    - backend: "mistral"
      model: "mistral-large-latest"
      priority: 1

  # Cohere 模型示例
  "cohere/command-r-plus":
    routes:
    - backend: "cohere"
      model: "command-r-plus"
      priority: 1

fallback:
  cooldown_seconds: 300
  max_retries: 0  # 默认不重试，立即切换到其他后端
  alias_fallback:
    "anthropic/claude-sonnet-4":
    - "openai/gpt-4o"
  
  enable_backoff: true
  backoff_initial_delay: 100
  backoff_max_delay: 5000
  backoff_multiplier: 2.0
  backoff_jitter: 0.1
  
  enable_circuit_breaker: false
  circuit_failure_threshold: 5
  circuit_success_threshold: 2
  circuit_open_timeout: 60

timeout:
  connect_timeout: 10s
  read_timeout: 60s
  write_timeout: 60s
  total_timeout: 15m

detection:
  error_codes: [ "4xx", "5xx" ]
  error_patterns:
  - "insufficient_quota"
  - "rate_limit"
  - "exceeded"
  - "billing"
  - "quota"
  - "organization has been disabled"
  - "upstream_all_accounts_busy"
  - "upstream_no_eligible_accounts"
  - "invalid chat setting"

# 日志配置
logging:
  # 基础配置（向后兼容）
  level: "info"                      # 文件日志级别: debug/info/warn/error
  console_level: "info"              # 控制台日志级别（默认继承level）
  
  base_dir: "./logs"                 # 日志根目录
  max_file_size_mb: 100              # 单个文件最大100MB
  max_age_days: 7                    # 日志保留7天后删除
  max_backups: 21                    # 最多保留21个备份
  compress: true                     # 压缩旧日志为.gz
  format: "json"                     # json格式（机器可读）
  colorize: true                     # 启用控制台着色
  console_style: "compact"           # 输出风格: compact/verbose
  console_format: "markdown"         # 控制台输出格式: markdown/plain
  debug_mode: true                   # true时输出llm_debug日志
  async: true                        # 异步写入
  buffer_size: 10000                 # 缓冲区大小
  flush_interval: 5                  # 5秒自动刷新
  drop_on_full: false                # 缓冲区满时丢弃日志
  rotate_by_size: true               # 按大小轮转
  rotate_by_time: false              # 按时间轮转
  time_rotation: "daily"             # 时间轮转策略: daily/hourly
  mask_sensitive: true               # 脱敏API Key、Token
  detailed_masking: false            # 详细脱敏（包括邮箱、IP等）
  
  # 独立日志目录
  request_dir: "./logs/requests"
  error_dir: "./logs/errors"
  separate_files: false
  
  # 新增：启用多目标日志系统（推荐使用新的配置方式）
  enable_multi_target: true          # 启用多目标日志
  
  # 控制台输出配置
  console:
    enabled: true                    # 启用控制台输出
    level: "info"                    # 控制台日志级别
    style: "compact"                 # compact/verbose
    format: "markdown"               # markdown/plain
    colorize: true                   # 启用颜色
    
  # 文件输出配置
  file:
    enabled: true                    # 启用文件输出
    level: "debug"                   # 文件日志级别
    base_dir: "./logs"               # 日志根目录
    max_size_mb: 100                 # 单个文件最大100MB
    max_age_days: 7                  # 日志保留天数
    max_backups: 10                  # 最多保留备份数
    compress: true                   # 压缩旧日志
    format: "json"                   # json/text
    
  # 分类日志配置（各分类独立配置输出目标和级别）
  categories:
    # 普通日志：同时输出到控制台和文件
    general:
      target: "both"                 # 输出目标: console/file/both/none
      levels:
        console: "info"              # 控制台显示 info 及以上
        file: "debug"                # 文件记录 debug 及以上
      path: "general.log"
      
    # 请求日志：仅输出到文件（详细请求/响应数据）
    request:
      target: "file"
      levels:
        console: "warn"              # 请求日志不在控制台显示，除非是警告
        file: "debug"
      path: "requests/requests.log"
      max_size: 200                  # 请求日志文件更大
      max_age: 14                    # 保留更长时间
      compress: true
      
    # 错误日志：同时输出到控制台和文件
    error:
      target: "both"
      levels:
        console: "error"
        file: "error"
      path: "errors/errors.log"
      max_size: 100
      max_age: 30                    # 错误日志保留更久
      compress: true
      
    # 网络日志：仅输出到文件
    network:
      target: "file"
      levels:
        console: "info"
        file: "debug"
      path: "network/network.log"
      
    # 调试日志：仅输出到文件
    debug:
      target: "file"
      levels:
        console: "debug"
        file: "debug"
      path: "debug/debug.log"
      
    # 请求体日志：完整的 HTTP 请求/响应体（仅文件输出）
    request_body:
      target: "file"
      levels:
        console: "none"              # 请求体日志不输出到控制台
        file: "debug"
      path: "request_body/{date}/{time}_{req_id}_{type}.httpdump"
      max_size: 200                  # 单文件最大200MB
      max_age: 14                    # 保留14天
      max_backups: 10                # 最多10个备份
      compress: true                 # 压缩旧文件
      
  # 请求体日志专用配置（独立于多目标日志系统）
  request_body:
    enabled: true                    # 启用请求体日志
    base_dir: "./logs/request_body"  # 请求体日志基础目录
    max_size_mb: 200                 # 单文件最大200MB
    max_age_days: 14                 # 保留14天
    max_backups: 10                  # 最多10个备份
    compress: true                   # 压缩旧文件
    include_body: true               # 包含请求/响应体内容
