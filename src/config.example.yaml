listen: ":8080"

proxy_api_key: "sk-your-unified-api-key"

proxy:
  enable_system_prompt: false
  forward_client_ip: true

backends:
- name: "primary"
  url: "https://api.primary-provider.com/v1"
  api_key: "sk-primary-xxx"

- name: "secondary"
  url: "https://api.secondary-provider.com/v1"
  api_key: "sk-secondary-yyy"
  enabled: false

# Anthropic 协议示例
- name: "anthropic"
  url: "https://api.anthropic.com"
  api_key: "sk-ant-xxx"
  protocol: "anthropic"  # 指定使用 Anthropic 协议

models:
  "anthropic/claude-sonnet-4":
    routes:
    - backend: "primary"
      model: "claude-sonnet-4"
      priority: 1
    - backend: "secondary"
      model: "claude-sonnet-4"
      priority: 2
      enabled: false

  "openai/gpt-4o":
    enabled: false
    routes:
    - backend: "primary"
      model: "gpt-4o"
      priority: 1

fallback:
  cooldown_seconds: 300
  max_retries: 3
  alias_fallback:
    "anthropic/claude-sonnet-4":
    - "openai/gpt-4o"
  
  enable_backoff: true
  backoff_initial_delay: 100
  backoff_max_delay: 5000
  backoff_multiplier: 2.0
  backoff_jitter: 0.1
  
  enable_circuit_breaker: false
  circuit_failure_threshold: 5
  circuit_success_threshold: 2
  circuit_open_timeout: 60

timeout:
  connect_timeout: 10s
  read_timeout: 60s
  write_timeout: 60s
  total_timeout: 15m

detection:
  error_codes: [ "4xx", "5xx" ]
  error_patterns:
  - "insufficient_quota"
  - "rate_limit"
  - "exceeded"
  - "billing"
  - "quota"
  - "organization has been disabled"
  - "upstream_all_accounts_busy"
  - "upstream_no_eligible_accounts"
  - "invalid chat setting"

# 日志配置
logging:
  # 基础配置（向后兼容）
  level: "info"                      # 文件日志级别: debug/info/warn/error
  console_level: "info"              # 控制台日志级别（默认继承level）
  
  base_dir: "./logs"                 # 日志根目录
  max_file_size_mb: 100              # 单个文件最大100MB
  max_age_days: 7                    # 日志保留7天后删除
  max_backups: 21                    # 最多保留21个备份
  compress: true                     # 压缩旧日志为.gz
  format: "json"                     # json格式（机器可读）
  colorize: true                     # 启用控制台着色
  console_style: "compact"           # 输出风格: compact/verbose
  console_format: "markdown"         # 控制台输出格式: markdown/plain
  debug_mode: true                   # true时输出llm_debug日志
  async: true                        # 异步写入
  buffer_size: 10000                 # 缓冲区大小
  flush_interval: 5                  # 5秒自动刷新
  drop_on_full: false                # 缓冲区满时丢弃日志
  rotate_by_size: true               # 按大小轮转
  rotate_by_time: false              # 按时间轮转
  time_rotation: "daily"             # 时间轮转策略: daily/hourly
  mask_sensitive: true               # 脱敏API Key、Token
  detailed_masking: false            # 详细脱敏（包括邮箱、IP等）
  
  # 独立日志目录
  request_dir: "./logs/requests"
  error_dir: "./logs/errors"
  separate_files: false
  
  # 新增：启用多目标日志系统（推荐使用新的配置方式）
  enable_multi_target: true          # 启用多目标日志
  
  # 控制台输出配置
  console:
    enabled: true                    # 启用控制台输出
    level: "info"                    # 控制台日志级别
    style: "compact"                 # compact/verbose
    format: "markdown"               # markdown/plain
    colorize: true                   # 启用颜色
    
  # 文件输出配置
  file:
    enabled: true                    # 启用文件输出
    level: "debug"                   # 文件日志级别
    base_dir: "./logs"               # 日志根目录
    max_size_mb: 100                 # 单个文件最大100MB
    max_age_days: 7                  # 日志保留天数
    max_backups: 10                  # 最多保留备份数
    compress: true                   # 压缩旧日志
    format: "json"                   # json/text
    
  # 分类日志配置（各分类独立配置输出目标和级别）
  categories:
    # 普通日志：同时输出到控制台和文件
    general:
      target: "both"                 # 输出目标: console/file/both/none
      levels:
        console: "info"              # 控制台显示 info 及以上
        file: "debug"                # 文件记录 debug 及以上
      path: "general.log"
      
    # 请求日志：仅输出到文件（详细请求/响应数据）
    request:
      target: "file"
      levels:
        console: "warn"              # 请求日志不在控制台显示，除非是警告
        file: "debug"
      path: "requests/requests.log"
      max_size: 200                  # 请求日志文件更大
      max_age: 14                    # 保留更长时间
      compress: true
      
    # 错误日志：同时输出到控制台和文件
    error:
      target: "both"
      levels:
        console: "error"
        file: "error"
      path: "errors/errors.log"
      max_size: 100
      max_age: 30                    # 错误日志保留更久
      compress: true
      
    # 网络日志：仅输出到文件
    network:
      target: "file"
      levels:
        console: "info"
        file: "debug"
      path: "network/network.log"
      
    # 调试日志：仅输出到文件
    debug:
      target: "file"
      levels:
        console: "debug"
        file: "debug"
      path: "debug/debug.log"
