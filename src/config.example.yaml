listen: ":8080"

proxy_api_key: "sk-your-unified-api-key"

proxy:
  enable_system_prompt: false
  forward_client_ip: true

backends:
- name: "primary"
  url: "https://api.primary-provider.com/v1"
  api_key: "sk-primary-xxx"
  locale: "zh-CN"  # 简体中文响应（默认区域）

- name: "secondary"
  url: "https://api.secondary-provider.com/v1"
  api_key: "sk-secondary-yyy"
  enabled: false

# Anthropic 协议示例
- name: "anthropic"
  url: "https://api.anthropic.com"
  api_key: "sk-ant-xxx"
  protocol: "anthropic"  # 指定使用 Anthropic 协议
  locale: "en-US"  # 英文响应

# Azure OpenAI 协议示例
- name: "azure-openai"
  url: "https://your-resource.openai.azure.com/openai/deployments/your-deployment"
  api_key: "your-azure-api-key"
  protocol: "azure"  # Azure 专用错误转换器
  timeout: 60s  # Azure 可能需要更长超时
  locale: "zh-CN"

# DeepSeek 协议示例
- name: "deepseek"
  url: "https://api.deepseek.com/chat/completions"
  api_key: "sk-deepseek-xxx"
  protocol: "deepseek"  # 支持 thinking mode

# Groq 协议示例
- name: "groq"
  url: "https://api.groq.com/openai/v1/chat/completions"
  api_key: "gsk-xxx"
  protocol: "groq"  # 高性能推理加速

# Mistral AI 协议示例
- name: "mistral"
  url: "https://api.mistral.ai/v1/chat/completions"
  api_key: "xxx"
  protocol: "mistral"  # 支持并行工具调用

# Cohere 协议示例
- name: "cohere"
  url: "https://api.cohere.com"
  api_key: "xxx"
  protocol: "cohere"  # RAG 和 citations 支持

# Google Vertex AI 协议示例
- name: "vertex-ai"
  url: "https://aiplatform.googleapis.com/v1/projects/your-project-id/locations/us-central1/publishers/google/models/gemini-1.5-pro"
  api_key: "your-oauth-token"  # OAuth 2.0 访问令牌
  protocol: "google"  # 多模态支持
  timeout: 60s

# Google Gemini API 协议示例（开发者版本）
- name: "gemini-api"
  url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro"
  api_key: "your-api-key"
  protocol: "google"

models:
  "anthropic/claude-sonnet-4":
    routes:
    - backend: "primary"
      model: "claude-sonnet-4"
      priority: 1
    - backend: "secondary"
      model: "claude-sonnet-4"
      priority: 2
      enabled: false

  "openai/gpt-4o":
    enabled: false
    routes:
    - backend: "primary"
      model: "gpt-4o"
      priority: 1

  # DeepSeek 模型示例
  "deepseek/deepseek-chat":
    routes:
    - backend: "deepseek"
      model: "deepseek-chat"
      priority: 1

  # Groq 模型示例（Llama 系列）
  "groq/llama-3.3-70b-versatile":
    routes:
    - backend: "groq"
      model: "llama-3.3-70b-versatile"
      priority: 1

  # Mistral 模型示例
  "mistral/mistral-large-latest":
    routes:
    - backend: "mistral"
      model: "mistral-large-latest"
      priority: 1

  # Cohere 模型示例
  "cohere/command-r-plus":
    routes:
    - backend: "cohere"
      model: "command-r-plus"
      priority: 1

  # Google Vertex AI 模型示例
  "google/gemini-1.5-pro":
    routes:
    - backend: "vertex-ai"
      model: "gemini-1.5-pro"
      priority: 1

  # Google Gemini API 模型示例
  "google/gemini-2.0-flash":
    routes:
    - backend: "gemini-api"
      model: "gemini-2.0-flash-exp"
      priority: 1

fallback:
  cooldown_seconds: 300
  max_retries: 0  # 默认不重试，立即切换到其他后端
  alias_fallback:
    "anthropic/claude-sonnet-4":
    - "openai/gpt-4o"
  
  enable_backoff: true
  backoff_initial_delay: 100
  backoff_max_delay: 5000
  backoff_multiplier: 2.0
  backoff_jitter: 0.1
  
  enable_circuit_breaker: false
  circuit_failure_threshold: 5
  circuit_success_threshold: 2
  circuit_open_timeout: 60

timeout:
  connect_timeout: 10s
  read_timeout: 60s
  write_timeout: 60s
  total_timeout: 15m

error_fallback:
  server_error:
    enabled: true

  client_error:
    enabled: true
    codes: [401, 403, 429]
    patterns:
      - "insufficient_quota"
      - "rate_limit"
      - "exceeded"
      - "billing"
      - "quota"
      - "organization has been disabled"
      - "upstream_all_accounts_busy"
      - "upstream_no_eligible_accounts"
      - "invalid chat setting"

# 日志配置（精简版）
logging:
  # 基础目录
  base_dir: "./logs"
  
  # 脱敏配置
  mask_sensitive: true
  
  # 异步写入配置
  async:
    enabled: true
    buffer_size: 10000
    flush_interval_seconds: 5
    drop_on_full: false
  
  # 日志轮转配置（支持按大小和按时间）
  rotation:
    max_size_mb: 100          # 按大小轮转：单个文件最大100MB
    time_strategy: "daily"    # 按时间轮转策略: daily/hourly/none
    max_age_days: 7           # 保留天数
    max_backups: 21           # 最大备份数
    compress: true            # 压缩旧日志
  
  # 日志分类配置（level: debug/info/warn/error/none）
  categories:
    general:
      level: "info"           # 日志级别
      target: "both"          # 输出目标: console/file/both/none
      path: "general.log"     # 文件路径（相对于 base_dir）
      
    request:
      level: "info"
      target: "file"
      path: "requests/requests.log"
      max_size_mb: 200        # 可覆盖全局轮转配置
      max_age_days: 14
      
    error:
      level: "error"
      target: "both"
      path: "errors/errors.log"
      max_age_days: 30
      
    network:
      level: "debug"
      target: "file"
      path: "network/network.log"
      
    debug:
      level: "debug"
      target: "file"
      path: "debug/debug.log"
      
    request_body:
      level: "debug"
      target: "file"
      path: "request_body/{date}/{time}_{req_id}_{type}.httpdump"
      max_size_mb: 200
      max_age_days: 14
      include_body: true      # 是否包含请求/响应体内容
